# ConfigMap for non-sensitive configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: cv-hub-config
  namespace: cv-hub
data:
  api-url: "https://api.cv-hub.io"
  app-url: "https://cv-hub.io"
  embedding-model: "openai/text-embedding-3-small"
  graph-sync-concurrency: "3"
---
# Network Policy - restrict database access
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: database-access
  namespace: cv-hub
spec:
  podSelector:
    matchLabels:
      app: postgres
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: cv-hub-api
        - podSelector:
            matchLabels:
              app: cv-hub-worker
      ports:
        - protocol: TCP
          port: 5432
---
# PodDisruptionBudget for API
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: cv-hub-api-pdb
  namespace: cv-hub
spec:
  minAvailable: 2
  selector:
    matchLabels:
      app: cv-hub-api
---
# PodDisruptionBudget for Worker
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: cv-hub-worker-pdb
  namespace: cv-hub
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: cv-hub-worker
